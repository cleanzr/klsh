---
title: "Introduction to klsh Package"
author: "Rebecca C. Steorts"
date: "`r Sys.Date()`"
output: 
    rmarkdown::html_vignette:
        fig_caption: yes
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---
We present a small example from Steorts, R., Ventura, S., Sadinle, M., and Fienberg, S. (2014). "Blocking Comparisons for Record Linkage." Privacy in Statistical Databases (Lecture Notes in Computer Science 8744), ed. J Domingo-Ferrer, Springer, 252-268, DOI:10.1007/978-3-319-11257-220. We will be using the RecordLinkage package in R and the RLdata500 data set. 

In a record linkage task one wants to remove duplicate 
entries from multiple databases. However, before performing this task, one needs to perform a means of dimension reduction so that the record linkage task is computationally scalable. 
 
Using the KLSH algorithm, we illustrate an example of using this package using a German dataset comprised of first and last name and full date of birth. 

Our goals include

- Presenting the RLdata500 dataset with summary information.
- Illustrating how we can format the RLdata500 dataset to work with the klsh
- Running KLSH on the RLdata500 data set to create blocks
- Explaining the tunning parameters of KLSH and how to choose these in practice with evaluation metrics.
- Sample output and visualizations 

## Understanding the RLdata500 dataset

The RLdata500 dataset exists already in the RecordLinkage package in R. We review this data set for the user. 

The RLdata500 data consists of 500 records with 10 percent duplication. Thus, there are 450 unique individuals. There is full information on each record containing first name, last name, and full date of birth. 

We first load the Record Linkgae package and load the RLdata500 data set. We also, provide the first few lines of the data. We also remove missing values (they are all missing in this data set). 

```{r, echo=TRUE, message=FALSE, knitr::opts_chunk$set(cache=TRUE)}
library(RecordLinkage)
library(klsh)
data(RLdata500)
head(RLdata500)
data.500 <- RLdata500[-c(2,4)]
head(data.500)
```

## KLSH applied to RLdata500

We now explain how to run KLSH on the RLdata500 data set. Here, we use a total number of blocks to be 5 and the total number of random projections to be 20. 

```{r}
set.seed(1234)
klsh.blocks <- klsh(data.500, p=20, num.blocks=5, k=2)
```

We now check the recall of the algorithm and the reduction ratio. 

```{r}
confusion.from.blocking(klsh.blocks)
confusion.from.blocking(klsh.blocks, recall.only=TRUE)
reduction.ratio.from.blocking(klsh.blocks)
```

KLSH applied to RLdata500
===
